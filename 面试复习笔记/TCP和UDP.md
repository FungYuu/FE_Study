## OSI七层模型和TCP/IP四层模型

![图片说明](https://uploadfiles.nowcoder.com/images/20210407/1449535_1617802322964/C21F44E81038ABD357BE1DB058D54FA5)



![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1e8e168d9f249788c74c5b50e0528e2~tplv-k3u1fbpfcp-watermark.awebp)



##  TCP 和 UDP 

TCP 和 UDP 都位于计算机网络模型中的**传输层**，它们负责**传输应用层产生的数据。**



### TCP 是什么

- **TCP 是传输控制协议**。

  是一种**面向连接的、可靠的、 基于IP**的传输层协议

  通过三次握手来建立 TCP 连接，三次握手就是用来启动和确认 TCP 连接的过程。

#### TCP 的主要特点

- TCP 能够确保连接的建立和数据包的发送
- TCP 支持错误重传机制
- TCP 支持拥塞控制，能够在网络拥堵的情况下延迟发送
- TCP 能够提供错误校验和，甄别有害的数据包。



### UDP 是什么

- **UDP 是用户数据报协议**。

  是一个**无连接**的**简单的面向数据报**的运输层协议。

  **数据报**是与分组交换网络关联的传输单元。

#### UDP 的特点

- UDP 能够支持容忍数据包丢失的带宽密集型应用程序
- UDP 具有低延迟的特点
- UDP 能够发送大量的数据包
- UDP 能够允许 DNS 查找，DNS 是建立在 UDP 之上的应用层协议。



##  TCP 和 UDP 的区别

1. TCP面向连接（（如打电话要先拨号建立连接）

   UDP是无连接的，即发送数据之前不需要建立连接。

2. TCP要求安全性，提供可靠的服务，通过TCP连接传送的数据，不丢失、不重复、安全可靠。

   UDP尽最大努力交付，即不保证可靠交付。

3. TCP是点对点连接的

   UDP一对一，一对多，多对多都可以

4. TCP传输效率相对较低

   UDP传输效率高，它适用于对高速传输和实时性有较高的通信或广播通信。

5. TCP适合用于网页，邮件等

   UDP适合用于视频，会议等

6. TCP面向字节流

   UDP面向报文



### TCP 是如何保证可靠性的，UDP 为什么不可靠？

为什么 TCP 可靠？TCP 的可靠性体现在有状态和控制

- 会精准记录那些数据发送了，那些数据被对方接收了，那些没有被接收，而且保证数据包按序到达，不允许半点差错，这就是有状态
- 当意识到丢包了或者网络环境不佳，TCP 会根据具体情况调整自己的行为，控制自己的发送速度或者重发，这是可控制的

反之 UDP 就是无状态的和不可控制的



## 你对 TCP 滑动窗口有了解嘛？

- 在 TCP 链接中，对于发送端和接收端而言，TCP 需要把发送的数据放到**发送缓存区**, 将接收的数据放到**接收缓存区**。
- 而经常会存在发送端发送过多，而接收端无法消化的情况，所以就需要流量控制，就是在通过接收缓存区的大小，控制发送端的发送。
- 如果对方的接收缓存区满了，就不能再继续发送了。而这种流量控制的过程就需要在发送端维护一个发送窗口，在接收端维持一个接收窗口。

TCP 滑动窗口分为两种: **发送窗口**和**接收窗口**。



## TCP 三次握手

- 第一次握手：客户端发送网络包，服务端收到了。
  这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。

- 第二次握手：服务端发包，客户端收到了。
  这样客户端就能得出结论：服务端的接收、发送能力，客户端的发送能力是正常的。

  **不过此时服务器并不能确认客户端的接收能力是否正常。**

- 第三次握手：客户端发包，服务端收到了。
  这样服务端就能得出结论：客户端的接收、发送能力正常，服务器自己的发送、接收能力也正常。



### 为什么需要三次握手，两次行不行？

在上面



### 第几次握手可以带数据？

**第三次握手的时候，是可以携带数据的。**

- 假如第一次握手可以携带数据的话，如果有人要恶意攻击服务器，那他每次都在第一次握手中的 SYN(建立连接) 报文中放入大量的数据。

- 因为攻击者根本就不理服务器的接收、发送能力是否正常，然后疯狂着重复发 SYN (建立连接) 报文的话，这会让服务器花费很多时间、内存空间来接收这些报文。

  **相当于**

- 第一次握手不可以放数据，的原因就是会让服务器更加容易受到攻击了。

  而对于第三次的话，此时客户端已经处于 ESTABLISHED 状态。

  对于客户端来说，他已经建立起连接了， 并且也已经知道服务器的接收、发送能力是正常的了，所以能携带数据也没啥毛病。

  

## TCP四次挥手

即终止TCP连接，需要客户端和服务端总共发送4个包确认连接的断开。

- 第1次挥手由客户端向服务端发起，服务端收到信息后就能确定客户端已经停止发送数据。
- 第2次挥手由服务端向客户端发起，客户端收到消息后就能确定服务端已经知道客户端不会再发送数据。
- 第3次握手由服务端向客户端发起，客户端收到消息后就能确定服务端已经停止发送数据。
- 第4次挥手由客户端向服务端发起，服务端收到信息后就能确定客户端已经知道(我)服务端不会再发送数据。



### 为什么不是3次挥手

- 观察四次挥手过程可见报文段3包含了报文段2中的确认值，因此三次挥手只能将报文段3和报文段2合并
- 在客服端第1次挥手时，服务端可能还在发送数据。所以第2次挥手和第3次挥手不能合并。



### 为什么客户端发送 ACK 之后不直接关闭，而是要等一阵子才关闭。

- 要确保服务器是否已经收到了我们的 ACK (确认字符)报文

  如果没有收到的话，服务器会重新发 FIN (关闭连接)报文给客户端，客户端再次收到 ACK (确认字符)报文之后，就知道之前的 ACK(确认字符) 报文丢失了，然后再次发送 ACK(确认字符) 报文。



## 为什么TIME_WAIT的时间是2MSL(报文最大生存时间)呢





























































































































