### 权限控制、动态路由

- 有三种方案

#### 方案一：把所有的路由全部写死，注册所有的菜单(路径)

- 这个有安全风险，就是在url中输入其他权限的路由地址就会进入到那个权限
- **经过beforeEach在每次路由跳转的时候，都须要访问后台，经过后台返回的数据，判断存储在vuex中的token角色是否包含在目标路由可访问的角色权限中**

node在中间件中设置黑白名单

- 经过**beforeEach**在每次路由跳转的时候，判断存储在vuex中的token角色是否包含在目标路由可访问的角色当中
- 这样作,虽然可以达到效果.可是若是我将vuex当中的roles值更改,同样可以突破浏览器控制,访问到权限控制路由页面
- 权限控制不能彻底交给前端，每次路由跳转的时候都须要访问后台，经过后台返回的数据判断目标路由是否在权限内

#### 方案二：不同角色注册不同的路由

- 但是一旦添加新的角色，因为没有配置，这就需要修改前端代码，重新部署

#### 方案三：根据角色的菜单，动态生成路由映射

**后台传当前用户对应权限的路由表，前端通过调接口拿到后进行处理**

- 每一个登录的用户，他是一个角色，有自己对应的菜单
- 菜单里有url，对应路由里的path，path再对应component
- 以上是个数组routes，再使用addroutes把它动态加到main的children



### 目前vue当中进行权限控制的方案有两种：

第一种：前端进行权限逻辑控制 (路由数据在前端，根据后台返回数据进行选择性动态加载)

第二种：后台进行权限逻辑控制 (路由数据由后台返回给前端进行动态加载)



### 登录拦截(权限控制)

- 首次登录时，后端服务器判断用户账号密码正确之后，根据用户id、用户名、定义好的秘钥、过期时间生成 token ，返回给前端；
- 前端拿到后端返回的 token ,存储在 localStroage 和 Vuex 里；
- 前端每次路由跳转，判断 localStroage 有无 token ，没有则跳转到登录页，有则请求获取用户信息，改变登录状态；
- 每次请求接口，在 Axios 请求头里携带 token;
- 后端接口判断请求头有无 token，没有或者 token 过期，返回401；



### setup函数中使用useStore时，没有进行类型的限制

- 拿到的是any类型
- 技巧
  - 在store/index.ts中导出一个useStore函数，并给这个函数指定类型，这个类型结合了**根模块类型及各个子模块的类型**，函数返回的仍然是Vuex的useStore



### 重置、搜索功能的实现

- page-search组件emit发送重置、搜索事件到上级组件，上级组件ref再传到page-content组件进⾏⽹络请求



### 自动化部署

#### 传统的开发模式

- 整个开发过程按步就班
- 工作上很不协调
  - 开发人员在开发阶段，测试和运维人员其实是处于等待的状态。等到测试阶段，开发人员等待测试反馈bug，也会处于等待状态
- 线上bug隐患
  - 项目准备交付时，突然出现了bug，所有人员需要加班、等待问题的处理；

#### DevOps开发模式

- 将开发和运维结合起来的工作模式
- 可以持续集成和持续交付，就是开发将代码push到仓库后，会自动打包部署到服务器，运维也可以同时使用，如果发现bug也可以快速告知开发修改

### 搭建服务器环境

#### jenkins自动化部署

- 安装java环境
- 安装jenkins
  - 启动jenkins服务(Jenkins默认使用8080端口提供服务，所以需要加入到安全组中)
- jenkins配置
  - 这是有图形化界面的，在浏览器输入服务器IP地址，端口号为8080
  - 输入密码(详细步骤不再描述)
  - 下载推荐的插件
- jenkins任务
  - 新建任务
  - 配置项目和保留策略
  - 源码管理
    - github需要token确认身份
    - gitee需要令牌确认身份
  - 构建触发器
    - 这步就是定义隔多久执行一次任务进行自动化部署项目
    - 有规则
  - 构建环境
    - 安装node插件
    - 构建执行的任务(代码)
      - 这步其实和git上clone下来之后的操作差不多，` npm install`下载依赖，之后` npm run build`进行打包
      - 删除nginx中新建项目文件夹中的内容，并将打包后的文件放入其中

#### nginx安装和配置

- 在服务器安装nginx
  - 启动nginx
- 配置nginx
- 在root文件夹通过linux命令创建文件夹和文件

```shell
mkdir back_stage
cd back_stage
touch index.html

//编辑
vi index.html
hello nginx
```

- 配置访问目录

```shell
vi /etc/nginx/nginx.conf
```

- 这些配置也都可以使用可视化来进行配置
  - 在VSCode上安装Remote-SSH插件，与服务器进行ssh远程连接
  - 连接成功后可以打开服务器中的文件，可以进去修改配置

- 最后修改完，重启nginx